<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·€ì—¬ìš´ í¬ì¼•ëª¬ ëŒë³´ê¸° ê²Œì„</title>

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #fef7e6;
            font-family: sans-serif;
            overflow: hidden;
            /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            touch-action: none;
            /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        .screen {
            display: none;
        }

        #selectScreen {
            text-align: center;
        }

        .choice {
            display: inline-block;
            margin: 20px;
            cursor: pointer;
        }

        .choice img {
            width: 160px;
            height: 160px;
            border-radius: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
            transition: 0.2s;
        }

        .choice img:hover {
            transform: scale(1.05);
        }

        #finalScreen {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
        }

        #finalAnimal {
            width: 200px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.25);
            transition: transform 0.2s;
            z-index: 10;
        }

        #status {
            position: fixed;
            top: 20px;
            font-size: 22px;
            font-weight: bold;
            width: 100%;
            text-align: center;
            z-index: 9999;
        }

        .heart {
            position: absolute;
            font-size: 28px;
            animation: floatUp 1.2s ease-out forwards;
            pointer-events: none;
            z-index: 99999;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-120px) scale(1.1);
            }
        }

        #arrow {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            animation: blink 1s infinite;
            display: block;
            /* í•­ìƒ í‘œì‹œ */
            z-index: 9999;
        }

        @keyframes blink {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- ì„ íƒ í™”ë©´ -->
    <div id="selectScreen" class="screen">
        <h2>ë²„ë ¤ì§„ í¬ì¼•ëª¬ë“¤ì´ì•¼. í•œ ë§ˆë¦¬ë¥¼ ë°ë ¤ê°€ë ´</h2>
        <div class="choice" onclick="selectAnimal('pikachu.png')">
            <img src="pikachu.png"><br>í”¼ìºŒì¸„
        </div>
        <div class="choice" onclick="selectAnimal('fire.png')">
            <img src="fire.png"><br>íŒŒì´ë¦´ìŠ¤
        </div>
        <div class="choice" onclick="selectAnimal('kkobuk.jpg')">
            <img src="kkobuk.jpg"><br>ê¼¬ë¶í¬
        </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="finalScreen" class="screen">
        <div id="status">
            ë‚˜ë„ ë“œë””ì–´ ì£¼ì¸ì´ ìƒê²¼ì–´,,, ë– ëŒì´ê°€ ì•„ë‹ˆì•¼
            <p>ë‚  ëˆŒëŸ¬ì„œ í‚¤ì›Œì¤˜ ì£¼ì¸</p>
        </div>
        <img id="finalAnimal" src="">
        <div id="arrow">â¬†ï¸ ë©ˆì¶”ë©´ ì•ˆë¼â€¦ ê³„ì† ì“°ë‹¤ë“¬ì–´ì¤˜â€¦</div>
    </div>

    <script>
        document.getElementById("selectScreen").style.display = "block";

        let health = 100;
        let alive = true;
        let scale = 0.25;
        const maxScale = 2;

        let firstPhase = true;

        let moveX = 0;
        let dir = 1;
        const moveSpeed = 2;

        let touching = false;

        const fallMessages = [
            "ëª¸ì´ ì•„íŒŒ..",
            "ë‚˜ ë²„ë¦¬ì§€ ë§ì•„ì¤˜... ğŸ¥º",
            "ê³„ì† ë§Œì ¸ì¤˜... ğŸ™",
            "ë‚˜ í˜¼ì ë‘ì§€ ë§ˆ... ğŸ˜­",
            "ì‚´ê³  ì‹¶ì–´... ğŸ˜¢",
            "ì‚¬ë‘í•´ì¤˜... ğŸ˜¨"
        ];
        let msgIndex = 0;
        let msgTimer = null;

        const animalEl = document.getElementById("finalAnimal");
        const statusEl = document.getElementById("status");
        const arrowEl = document.getElementById("arrow");

        /* ë™ë¬¼ ì„ íƒ */
        function selectAnimal(src) {
            document.getElementById("selectScreen").style.display = "none";
            document.getElementById("finalScreen").style.display = "block";
            animalEl.src = src;

            startMovement();
            setInterval(updateHealth, 250);

            const healEvent = (e) => {
                const pos = getXY(e);

                if (firstPhase) {
                    grow();
                } else {
                    heal(20);
                }

                createHeart(pos.x, pos.y);
            };

            animalEl.addEventListener("click", healEvent);
            animalEl.addEventListener("touchstart", healEvent);
        }

        function getXY(e) {
            if (e.touches) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            return { x: e.clientX, y: e.clientY };
        }

        /* ì¢Œìš° ì´ë™ */
        function startMovement() {
            const boundary = window.innerWidth * 0.35;
            setInterval(() => {
                if (!alive) return;
                moveX += dir * moveSpeed;
                if (moveX > boundary) dir = -1;
                if (moveX < -boundary) dir = 1;
                animalEl.style.transform = `translate(calc(-50% + ${moveX}px), -50%) scale(${scale})`;
            }, 30);
        }

        /* ì²´ë ¥ ê°ì†Œ */
        function updateHealth() {
            if (firstPhase) return;
            if (!touching) health -= alive ? 8 : 15;
            if (alive && health <= 15) fallDown();
        }

        /* ì“°ëŸ¬ì§ */
        function fallDown() {
            if (!alive) return; // ì´ë¯¸ ì“°ëŸ¬ì§ ì²˜ë¦¬ë¨
            alive = false;
            health = 0;

            animalEl.style.transform = `translate(calc(-50% + ${moveX}px), -50%) rotate(-90deg) scale(${scale})`;

            // ì¦‰ì‹œ ì²« ë¬¸êµ¬ í‘œì‹œ
            statusEl.textContent = fallMessages[msgIndex % fallMessages.length];
            msgIndex++;

            // ì´í›„ ìˆœí™˜
            if (msgTimer) clearInterval(msgTimer);
            msgTimer = setInterval(() => {
                statusEl.textContent = fallMessages[msgIndex % fallMessages.length];
                msgIndex++;
            }, 2500);
        }

        /* íšŒë³µ */
        function heal(amount) {
            touching = true;

            if (!alive) {
                health += amount;
                if (health >= 11) revive();
                setTimeout(() => touching = false, 150);
                return;
            }

            health += amount;
            if (health > 100) health = 100;
            setTimeout(() => touching = false, 120);
        }

        function revive() {
            alive = true;
            statusEl.textContent = "ë‹¤ì‹œ ì›€ì§ì¼ê²Œâ€¦ ê³ ë§ˆì›Œâ€¦ ğŸ¥º";
            if (msgTimer) {
                clearInterval(msgTimer);
                msgTimer = null;
            }
            animalEl.style.transform = `translate(calc(-50% + ${moveX}px), -50%) scale(${scale})`;
        }

        /* ì„±ì¥ */
        function grow() {
            if (scale < maxScale) scale += 0.02;

            if (scale >= 0.7 && firstPhase) {
                firstPhase = false;
                fallDown();
            }

            animalEl.style.transform = `translate(calc(-50% + ${moveX}px), -50%) scale(${scale})`;
        }

        /* í•˜íŠ¸ */
        function createHeart(x, y) {
            const h = document.createElement("div");
            h.classList.add("heart");
            h.textContent = "â¤ï¸";
            h.style.left = x + "px";
            h.style.top = y + "px";
            document.body.appendChild(h);
            setTimeout(() => h.remove(), 1000);
        }

        /* ì† ë–¼ë©´ ì¦‰ì‹œ ì“°ëŸ¬ì§ */
        function stopTouch() {
            touching = false;
            if (firstPhase) return;
            if (!alive) return;
            fallDown();
        }

        document.addEventListener("mouseup", stopTouch);
        document.addEventListener("touchend", stopTouch);
    </script>
</body>

</html>